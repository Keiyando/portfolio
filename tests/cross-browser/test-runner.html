<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ - çµ±åˆãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #2563eb;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        .browser-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .info-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .info-card h3 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .info-value {
            font-weight: 600;
            color: #2563eb;
        }

        .test-suites {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-suite {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .test-suite:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }

        .test-suite h3 {
            color: #1f2937;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            font-size: 1.3rem;
        }

        .test-suite .icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .test-suite p {
            color: #6b7280;
            margin-bottom: 20px;
        }

        .run-button {
            width: 100%;
            padding: 12px 24px;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .run-button:hover:not(:disabled) {
            background: linear-gradient(135deg, #1d4ed8, #1e3a8a);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .run-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .run-button.running {
            background: #3b82f6;
        }

        .run-button.completed {
            background: #10b981;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            display: inline-block;
        }

        .status-pending { background: #6b7280; }
        .status-running { background: #3b82f6; animation: pulse 1.5s infinite; }
        .status-completed { background: #10b981; }
        .status-error { background: #ef4444; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .master-controls {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .master-controls h2 {
            color: #1f2937;
            margin-bottom: 20px;
            text-align: center;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .master-button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .master-button.primary {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
        }

        .master-button.secondary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
        }

        .master-button.danger {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
        }

        .master-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .results-container {
            margin-top: 30px;
        }

        .results-summary {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .summary-item .number {
            font-size: 2rem;
            font-weight: bold;
            color: #2563eb;
            display: block;
        }

        .summary-item .label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .test-log {
            background: #1f2937;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 14px;
            color: #e5e7eb;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-info { color: #60a5fa; }
        .log-success { color: #34d399; }
        .log-warning { color: #fbbf24; }
        .log-error { color: #f87171; }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563eb, #3b82f6);
            transition: width 0.3s ease;
            width: 0%;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .test-suites {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆçµ±åˆãƒ©ãƒ³ãƒŠãƒ¼</h1>
            <p>ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚µã‚¤ãƒˆã®åŒ…æ‹¬çš„ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒ†ã‚¹ãƒˆ</p>
        </div>

        <div class="browser-info" id="browserInfo">
            <!-- ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±ãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
        </div>

        <div class="master-controls">
            <h2>ğŸ›ï¸ ãƒã‚¹ã‚¿ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
            <div class="control-buttons">
                <button class="master-button primary" onclick="runAllTests()">
                    ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                </button>
                <button class="master-button secondary" onclick="generateFullReport()">
                    ğŸ“Š ç·åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                </button>
                <button class="master-button secondary" onclick="exportResults()">
                    ğŸ“‹ çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
                <button class="master-button danger" onclick="clearResults()">
                    ğŸ—‘ï¸ çµæœã‚¯ãƒªã‚¢
                </button>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgress"></div>
            </div>
            <div id="progressText" style="text-align: center; margin-top: 10px; color: #6b7280;">
                å¾…æ©Ÿä¸­...
            </div>
        </div>

        <div class="test-suites">
            <div class="test-suite" id="suite-automated">
                <h3><span class="icon">ğŸ¤–</span> è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆ</h3>
                <p>ãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½ã‚µãƒãƒ¼ãƒˆã€JavaScript APIã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è‡ªå‹•æ¤œè¨¼</p>
                <div class="status-indicator status-pending" id="status-automated"></div>
                <button class="run-button" onclick="runAutomatedTests()" id="btn-automated">
                    å®Ÿè¡Œ
                </button>
            </div>

            <div class="test-suite" id="suite-responsive">
                <h3><span class="icon">ğŸ“±</span> ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆ</h3>
                <p>å„è§£åƒåº¦ã§ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç¢ºèªã¨ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆæœ€é©åŒ–æ¤œè¨¼</p>
                <div class="status-indicator status-pending" id="status-responsive"></div>
                <button class="run-button" onclick="runResponsiveTests()" id="btn-responsive">
                    å®Ÿè¡Œ
                </button>
            </div>

            <div class="test-suite" id="suite-functional">
                <h3><span class="icon">âš™ï¸</span> æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
                <p>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ•ã‚©ãƒ¼ãƒ ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ä¸»è¦æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª</p>
                <div class="status-indicator status-pending" id="status-functional"></div>
                <button class="run-button" onclick="runFunctionalTests()" id="btn-functional">
                    å®Ÿè¡Œ
                </button>
            </div>

            <div class="test-suite" id="suite-edge">
                <h3><span class="icon">ğŸ”</span> ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
                <p>ç‰¹æ®Šç’°å¢ƒã€åˆ¶é™æ¡ä»¶ä¸‹ã§ã®å‹•ä½œã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç¢ºèª</p>
                <div class="status-indicator status-pending" id="status-edge"></div>
                <button class="run-button" onclick="runEdgeCaseTests()" id="btn-edge">
                    å®Ÿè¡Œ
                </button>
            </div>
        </div>

        <div class="results-container" id="resultsContainer" style="display: none;">
            <div class="results-summary">
                <h2>ğŸ“ˆ ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
                <div class="summary-grid" id="summaryGrid">
                    <!-- çµæœã‚µãƒãƒªãƒ¼ãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                </div>
            </div>
            
            <div class="test-log" id="testLog">
                <!-- ãƒ†ã‚¹ãƒˆãƒ­ã‚°ãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>

    <!-- ä¾å­˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ -->
    <script src="polyfills.js"></script>
    <script src="functional-tests.js"></script>
    <script src="edge-case-tests.js"></script>
    <script src="responsive-tester.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let testResults = {
            automated: null,
            responsive: null,
            functional: null,
            edge: null
        };
        
        let testProgress = {
            total: 4,
            completed: 0
        };

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            displayBrowserInfo();
            initializeTestRunner();
        });

        /**
         * ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±è¡¨ç¤º
         */
        function displayBrowserInfo() {
            const info = {
                browser: getBrowserName() + ' ' + getBrowserVersion(),
                platform: navigator.platform,
                userAgent: navigator.userAgent,
                viewport: `${window.innerWidth} Ã— ${window.innerHeight}`,
                screen: `${screen.width} Ã— ${screen.height}`,
                devicePixelRatio: window.devicePixelRatio || 1,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine
            };

            const container = document.getElementById('browserInfo');
            container.innerHTML = `
                <div class="info-card">
                    <h3>ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶</h3>
                    <div class="info-value">${info.browser}</div>
                </div>
                <div class="info-card">
                    <h3>ğŸ’» ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </h3>
                    <div class="info-value">${info.platform}</div>
                </div>
                <div class="info-card">
                    <h3>ğŸ“ ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ</h3>
                    <div class="info-value">${info.viewport}</div>
                </div>
                <div class="info-card">
                    <h3>ğŸ–¥ï¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è§£åƒåº¦</h3>
                    <div class="info-value">${info.screen}</div>
                </div>
                <div class="info-card">
                    <h3>ğŸ” ãƒ”ã‚¯ã‚»ãƒ«æ¯”</h3>
                    <div class="info-value">${info.devicePixelRatio}x</div>
                </div>
                <div class="info-card">
                    <h3>ğŸŒ è¨€èª</h3>
                    <div class="info-value">${info.language}</div>
                </div>
                <div class="info-card">
                    <h3>ğŸª Cookie</h3>
                    <div class="info-value">${info.cookieEnabled ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹'}</div>
                </div>
                <div class="info-card">
                    <h3>ğŸ“¡ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</h3>
                    <div class="info-value">${info.onLine ? 'âœ… æ¥ç¶šä¸­' : 'âŒ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³'}</div>
                </div>
            `;
        }

        /**
         * ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã®åˆæœŸåŒ–
         */
        function initializeTestRunner() {
            // ä¾å­˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ç¢ºèª
            const dependencies = [
                { name: 'FunctionalTests', available: typeof FunctionalTests !== 'undefined' },
                { name: 'EdgeCaseTests', available: typeof EdgeCaseTests !== 'undefined' },
                { name: 'ResponsiveTester', available: typeof ResponsiveTester !== 'undefined' }
            ];

            const missingDeps = dependencies.filter(dep => !dep.available);
            if (missingDeps.length > 0) {
                logMessage(`è­¦å‘Š: ä¾å­˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒä¸è¶³ - ${missingDeps.map(d => d.name).join(', ')}`, 'warning');
            }

            logMessage('ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼åˆæœŸåŒ–å®Œäº†', 'success');
        }

        /**
         * è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
         */
        async function runAutomatedTests() {
            updateSuiteStatus('automated', 'running');
            logMessage('ğŸ¤– è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            try {
                // è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œï¼ˆautomated-tests.htmlã®æ©Ÿèƒ½ã‚’çµ±åˆï¼‰
                const results = await runAutomatedTestSuite();
                testResults.automated = results;
                updateSuiteStatus('automated', 'completed');
                logMessage('âœ… è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
            } catch (error) {
                updateSuiteStatus('automated', 'error');
                logMessage(`âŒ è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }

            updateProgress();
        }

        /**
         * ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
         */
        async function runResponsiveTests() {
            updateSuiteStatus('responsive', 'running');
            logMessage('ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            try {
                if (typeof ResponsiveTester !== 'undefined') {
                    const results = await ResponsiveTester.runFullTest();
                    testResults.responsive = results;
                    updateSuiteStatus('responsive', 'completed');
                    logMessage('âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                } else {
                    throw new Error('ResponsiveTester not available');
                }
            } catch (error) {
                updateSuiteStatus('responsive', 'error');
                logMessage(`âŒ ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }

            updateProgress();
        }

        /**
         * æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
         */
        async function runFunctionalTests() {
            updateSuiteStatus('functional', 'running');
            logMessage('âš™ï¸ æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            try {
                if (typeof FunctionalTests !== 'undefined') {
                    const results = await FunctionalTests.runAllTests();
                    testResults.functional = results;
                    updateSuiteStatus('functional', 'completed');
                    logMessage('âœ… æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                } else {
                    throw new Error('FunctionalTests not available');
                }
            } catch (error) {
                updateSuiteStatus('functional', 'error');
                logMessage(`âŒ æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }

            updateProgress();
        }

        /**
         * ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
         */
        async function runEdgeCaseTests() {
            updateSuiteStatus('edge', 'running');
            logMessage('ğŸ” ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            try {
                if (typeof EdgeCaseTests !== 'undefined') {
                    const results = await EdgeCaseTests.runAllTests();
                    testResults.edge = results;
                    updateSuiteStatus('edge', 'completed');
                    logMessage('âœ… ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                } else {
                    throw new Error('EdgeCaseTests not available');
                }
            } catch (error) {
                updateSuiteStatus('edge', 'error');
                logMessage(`âŒ ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }

            updateProgress();
        }

        /**
         * å…¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
         */
        async function runAllTests() {
            logMessage('ğŸš€ å…¨ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            testProgress.completed = 0;
            updateOverallProgress();

            const tests = [
                runAutomatedTests,
                runResponsiveTests,
                runFunctionalTests,
                runEdgeCaseTests
            ];

            for (const test of tests) {
                await test();
                await sleep(500); // ãƒ†ã‚¹ãƒˆé–“ã®å¾…æ©Ÿæ™‚é–“
            }

            logMessage('ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
            showResults();
        }

        /**
         * è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®å®Ÿè¡Œ
         */
        async function runAutomatedTestSuite() {
            const tests = [
                { name: 'CSS Grid ã‚µãƒãƒ¼ãƒˆ', test: () => CSS.supports('display', 'grid') },
                { name: 'Flexbox ã‚µãƒãƒ¼ãƒˆ', test: () => CSS.supports('display', 'flex') },
                { name: 'CSS Variables ã‚µãƒãƒ¼ãƒˆ', test: () => CSS.supports('--custom-property', '1') },
                { name: 'IntersectionObserver API', test: () => 'IntersectionObserver' in window },
                { name: 'Fetch API', test: () => 'fetch' in window },
                { name: 'LocalStorage', test: () => {
                    try {
                        localStorage.setItem('test', 'test');
                        localStorage.removeItem('test');
                        return true;
                    } catch (e) {
                        return false;
                    }
                }}
            ];

            const results = [];
            for (const test of tests) {
                try {
                    const result = test.test();
                    results.push({
                        name: test.name,
                        status: result ? 'pass' : 'fail',
                        message: result ? 'ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿' : 'æœªã‚µãƒãƒ¼ãƒˆ'
                    });
                } catch (error) {
                    results.push({
                        name: test.name,
                        status: 'error',
                        message: error.message
                    });
                }
            }

            return results;
        }

        /**
         * ã‚¹ã‚¤ãƒ¼ãƒˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
         */
        function updateSuiteStatus(suite, status) {
            const statusIndicator = document.getElementById(`status-${suite}`);
            const button = document.getElementById(`btn-${suite}`);
            
            if (statusIndicator) {
                statusIndicator.className = `status-indicator status-${status}`;
            }
            
            if (button) {
                switch (status) {
                    case 'running':
                        button.textContent = 'å®Ÿè¡Œä¸­...';
                        button.disabled = true;
                        button.className = 'run-button running';
                        break;
                    case 'completed':
                        button.textContent = 'å®Œäº† âœ…';
                        button.disabled = false;
                        button.className = 'run-button completed';
                        break;
                    case 'error':
                        button.textContent = 'ã‚¨ãƒ©ãƒ¼ âŒ';
                        button.disabled = false;
                        button.className = 'run-button';
                        break;
                    default:
                        button.textContent = 'å®Ÿè¡Œ';
                        button.disabled = false;
                        button.className = 'run-button';
                }
            }
        }

        /**
         * é€²æ—æ›´æ–°
         */
        function updateProgress() {
            testProgress.completed++;
            updateOverallProgress();
        }

        /**
         * å…¨ä½“é€²æ—æ›´æ–°
         */
        function updateOverallProgress() {
            const percentage = (testProgress.completed / testProgress.total) * 100;
            const progressFill = document.getElementById('overallProgress');
            const progressText = document.getElementById('progressText');
            
            if (progressFill) {
                progressFill.style.width = `${percentage}%`;
            }
            
            if (progressText) {
                progressText.textContent = `${testProgress.completed}/${testProgress.total} å®Œäº† (${Math.round(percentage)}%)`;
            }
        }

        /**
         * çµæœè¡¨ç¤º
         */
        function showResults() {
            const container = document.getElementById('resultsContainer');
            container.style.display = 'block';
            generateResultsSummary();
        }

        /**
         * çµæœã‚µãƒãƒªãƒ¼ç”Ÿæˆ
         */
        function generateResultsSummary() {
            const summary = calculateOverallSummary();
            const grid = document.getElementById('summaryGrid');
            
            grid.innerHTML = `
                <div class="summary-item">
                    <span class="number">${summary.totalTests}</span>
                    <div class="label">ç·ãƒ†ã‚¹ãƒˆæ•°</div>
                </div>
                <div class="summary-item">
                    <span class="number">${summary.passed}</span>
                    <div class="label">æˆåŠŸ</div>
                </div>
                <div class="summary-item">
                    <span class="number">${summary.warnings}</span>
                    <div class="label">è­¦å‘Š</div>
                </div>
                <div class="summary-item">
                    <span class="number">${summary.failed}</span>
                    <div class="label">å¤±æ•—</div>
                </div>
                <div class="summary-item">
                    <span class="number">${summary.passRate}%</span>
                    <div class="label">æˆåŠŸç‡</div>
                </div>
                <div class="summary-item">
                    <span class="number">${summary.totalDuration}ms</span>
                    <div class="label">å®Ÿè¡Œæ™‚é–“</div>
                </div>
            `;
        }

        /**
         * å…¨ä½“ã‚µãƒãƒªãƒ¼è¨ˆç®—
         */
        function calculateOverallSummary() {
            let totalTests = 0, passed = 0, warnings = 0, failed = 0, totalDuration = 0;

            Object.values(testResults).forEach(result => {
                if (result && Array.isArray(result)) {
                    totalTests += result.length;
                    result.forEach(test => {
                        if (test.status === 'pass') passed++;
                        else if (test.status === 'warning') warnings++;
                        else if (test.status === 'fail') failed++;
                        if (test.duration) totalDuration += test.duration;
                    });
                }
            });

            return {
                totalTests,
                passed,
                warnings,
                failed,
                passRate: totalTests > 0 ? Math.round((passed / totalTests) * 100) : 0,
                totalDuration
            };
        }

        /**
         * ç·åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
         */
        function generateFullReport() {
            const reportWindow = window.open('', '_blank', 'width=1000,height=800');
            const reportHTML = buildFullReportHTML();
            
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
            
            logMessage('ğŸ“Š ç·åˆãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ', 'success');
        }

        /**
         * ãƒ¬ãƒãƒ¼ãƒˆHTMLç”Ÿæˆ
         */
        function buildFullReportHTML() {
            const summary = calculateOverallSummary();
            const timestamp = new Date().toLocaleString('ja-JP');
            
            return `
                <!DOCTYPE html>
                <html lang="ja">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ ç·åˆãƒ¬ãƒãƒ¼ãƒˆ</title>
                    <style>
                        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 20px; line-height: 1.6; }
                        .header { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
                        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
                        .summary-item { text-align: center; padding: 15px; background: #e9ecef; border-radius: 6px; }
                        .test-section { margin: 30px 0; }
                        .test-result { padding: 10px; margin: 5px 0; border-radius: 4px; }
                        .pass { background: #d4edda; }
                        .warning { background: #fff3cd; }
                        .fail { background: #f8d7da; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ” ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ ç·åˆãƒ¬ãƒãƒ¼ãƒˆ</h1>
                        <p><strong>ã‚µã‚¤ãƒˆ:</strong> ${window.location.href}</p>
                        <p><strong>å®Ÿæ–½æ—¥æ™‚:</strong> ${timestamp}</p>
                        <p><strong>ãƒ–ãƒ©ã‚¦ã‚¶:</strong> ${getBrowserName()} ${getBrowserVersion()}</p>
                    </div>

                    <div class="summary">
                        <div class="summary-item">
                            <h3>${summary.totalTests}</h3>
                            <p>ç·ãƒ†ã‚¹ãƒˆæ•°</p>
                        </div>
                        <div class="summary-item">
                            <h3>${summary.passed}</h3>
                            <p>æˆåŠŸ</p>
                        </div>
                        <div class="summary-item">
                            <h3>${summary.warnings}</h3>
                            <p>è­¦å‘Š</p>
                        </div>
                        <div class="summary-item">
                            <h3>${summary.failed}</h3>
                            <p>å¤±æ•—</p>
                        </div>
                        <div class="summary-item">
                            <h3>${summary.passRate}%</h3>
                            <p>æˆåŠŸç‡</p>
                        </div>
                    </div>

                    ${Object.entries(testResults).map(([suite, results]) => {
                        if (!results || !Array.isArray(results)) return '';
                        return `
                            <div class="test-section">
                                <h2>${getSuiteName(suite)} (${results.length}ä»¶)</h2>
                                ${results.map(result => `
                                    <div class="test-result ${result.status}">
                                        <strong>${result.name}</strong>: ${result.message}
                                        ${result.duration ? ` (${result.duration}ms)` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }).join('')}
                </body>
                </html>
            `;
        }

        /**
         * ã‚¹ã‚¤ãƒ¼ãƒˆåå–å¾—
         */
        function getSuiteName(suite) {
            const names = {
                automated: 'ğŸ¤– è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆ',
                responsive: 'ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆ',
                functional: 'âš™ï¸ æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ',
                edge: 'ğŸ” ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ'
            };
            return names[suite] || suite;
        }

        /**
         * çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
         */
        function exportResults() {
            const exportData = {
                timestamp: new Date().toISOString(),
                browser: getBrowserName() + ' ' + getBrowserVersion(),
                platform: navigator.platform,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                results: testResults,
                summary: calculateOverallSummary()
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cross-browser-test-results-${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            logMessage('ğŸ“‹ çµæœã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
        }

        /**
         * çµæœã‚¯ãƒªã‚¢
         */
        function clearResults() {
            testResults = {
                automated: null,
                responsive: null,
                functional: null,
                edge: null
            };
            testProgress.completed = 0;
            
            // UI ã‚’ãƒªã‚»ãƒƒãƒˆ
            ['automated', 'responsive', 'functional', 'edge'].forEach(suite => {
                updateSuiteStatus(suite, 'pending');
            });
            
            updateOverallProgress();
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('testLog').innerHTML = '';
            
            logMessage('ğŸ—‘ï¸ çµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
        }

        /**
         * ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
         */
        function logMessage(message, type = 'info') {
            const log = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;

            console.log(`[TestRunner] ${message}`);
        }

        /**
         * ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
         */
        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome') && !ua.includes('Edg')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
            if (ua.includes('Edg')) return 'Edge';
            return 'Unknown';
        }

        function getBrowserVersion() {
            const ua = navigator.userAgent;
            let version = 'Unknown';
            try {
                if (ua.includes('Chrome')) {
                    version = ua.match(/Chrome\/([0-9.]+)/)[1];
                } else if (ua.includes('Firefox')) {
                    version = ua.match(/Firefox\/([0-9.]+)/)[1];
                } else if (ua.includes('Safari')) {
                    version = ua.match(/Safari\/([0-9.]+)/)[1];
                } else if (ua.includes('Edge')) {
                    version = ua.match(/Edge\/([0-9.]+)/)[1];
                }
            } catch (e) {
                // ãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—æ™‚ã¯ãã®ã¾ã¾
            }
            return version;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®å‡¦ç†
        window.addEventListener('resize', debounce(() => {
            displayBrowserInfo();
        }, 250));

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>